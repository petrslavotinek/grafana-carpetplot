{"version":3,"sources":["../src/carpetplot-ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","createConverter","aggregates","aggregatesMap","fragments","fragmentsMap","colorModes","colorModesMap","colorSpaces","colorSpacesMap","labelFormats","canvasRendering","carpetplotDisplayEditor","carpetplotAxesEditor","themeProvider","panelDefaults","aggregate","AVG","fragment","HOUR","color","mode","SPECTRUM","colorScheme","nullColor","customColors","colorSpace","RGB","scale","min","max","xAxis","show","showWeekends","minBucketWidthToShowWeekends","showCrosshair","labelFormat","yAxis","tooltip","legend","data","unitFormat","decimals","colorSchemes","name","value","invert","CarpetPlotCtrl","$scope","$injector","$rootScope","timeSrv","onDataReceived","dataList","transformData","render","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","onRender","onNullColorChange","newColor","panel","onCustomColorChange","customColor","fragmentOptions","aggregateOptions","colorModeOptions","colorSpaceOptions","xAxisLabelFormats","theme","getTheme","defaultsDeep","events","on","converter","range","timeRange","from","to","convertData","scope","elem","attrs","ctrl","push","i","length","splice","j","swapCustomColors","colors","temp","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,sB,kBAAAA,gB;;AACFC,O;;AACAC,S;;AAEAC,qB;;AACAC,gB;AAAcC,mB,eAAAA,a;;AACdC,e;AAAaC,kB,cAAAA,Y;;AACbC,gB;AAAcC,mB,eAAAA,a;;AACdC,iB;AAAeC,oB,gBAAAA,c;;AACbC,kB,sBAAAA,Y;;AACFC,qB;;AACEC,6B,kBAAAA,uB;;AACAC,0B,eAAAA,oB;;AACFC,mB;;;;;;;;;;;;;;;;;;;;;AAGDC,mB,GAAgB;AACpBC,mBAAWd,WAAWe,GADF;AAEpBC,kBAAUd,UAAUe,IAFA;AAGpBC,eAAO;AACLC,gBAAMf,WAAWgB,QADZ;AAELC,uBAAa,mBAFR;AAGLC,qBAAW,aAHN;AAILC,wBAAc,CAAC;AACbL,mBAAO;AADM,WAAD,EAEX;AACDA,mBAAO;AADN,WAFW,CAJT;AASLM,sBAAYlB,YAAYmB;AATnB,SAHa;AAcpBC,eAAO;AACLC,eAAK,IADA;AAELC,eAAK;AAFA,SAda;AAkBpBC,eAAO;AACLC,gBAAM,IADD;AAELC,wBAAc,IAFT;AAGLC,wCAA8B,CAHzB;AAILC,yBAAe,IAJV;AAKLC,uBAAa;AALR,SAlBa;AAyBpBC,eAAO;AACLL,gBAAM,IADD;AAELG,yBAAe;AAFV,SAzBa;AA6BpBG,iBAAS;AACPN,gBAAM;AADC,SA7BW;AAgCpBO,gBAAQ;AACNP,gBAAM;AADA,SAhCY;AAmCpBQ,cAAM;AACJC,sBAAY,OADR;AAEJC,oBAAU;AAFN;AAnCc,O;AAyChBC,kB,GAAe;AACnB;AACA,QAAEC,MAAM,UAAR,EAAoBC,OAAO,qBAA3B,EAAkDC,QAAQ,QAA1D,EAFmB,EAGnB,EAAEF,MAAM,QAAR,EAAkBC,OAAO,mBAAzB,EAA8CC,QAAQ,QAAtD,EAHmB;;AAKnB;AACA,QAAEF,MAAM,OAAR,EAAiBC,OAAO,kBAAxB,EAA4CC,QAAQ,MAApD,EANmB,EAOnB,EAAEF,MAAM,QAAR,EAAkBC,OAAO,mBAAzB,EAA8CC,QAAQ,MAAtD,EAPmB,EAQnB,EAAEF,MAAM,OAAR,EAAiBC,OAAO,kBAAxB,EAA4CC,QAAQ,MAApD,EARmB,EASnB,EAAEF,MAAM,SAAR,EAAmBC,OAAO,oBAA1B,EAAgDC,QAAQ,MAAxD,EATmB,EAUnB,EAAEF,MAAM,SAAR,EAAmBC,OAAO,oBAA1B,EAAgDC,QAAQ,MAAxD,EAVmB,EAWnB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EAXmB;;AAanB;AACA,QAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EAdmB,EAenB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EAfmB,EAgBnB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EAhBmB,EAiBnB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EAjBmB,EAkBnB,EAAEF,MAAM,QAAR,EAAkBC,OAAO,mBAAzB,EAA8CC,QAAQ,MAAtD,EAlBmB,EAmBnB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EAnBmB,EAoBnB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EApBmB,EAqBnB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EArBmB,EAsBnB,EAAEF,MAAM,QAAR,EAAkBC,OAAO,mBAAzB,EAA8CC,QAAQ,MAAtD,EAtBmB,EAuBnB,EAAEF,MAAM,MAAR,EAAgBC,OAAO,iBAAvB,EAA0CC,QAAQ,MAAlD,EAvBmB,EAwBnB,EAAEF,MAAM,QAAR,EAAkBC,OAAO,mBAAzB,EAA8CC,QAAQ,MAAtD,EAxBmB,EAyBnB,EAAEF,MAAM,QAAR,EAAkBC,OAAO,mBAAzB,EAA8CC,QAAQ,MAAtD,EAzBmB,C;;gCA4BRC,c;;;AAGX,gCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2CC,OAA3C,EAAoD;AAAA;;AAAA,sIAC5CH,MAD4C,EACpCC,SADoC;;AAAA,gBAsBpDG,cAtBoD,GAsBnC,UAACC,QAAD,EAAc;AAC7B,kBAAKA,QAAL,GAAgBA,QAAhB;AACA,kBAAKb,IAAL,GAAY,MAAKc,aAAL,CAAmBD,QAAnB,CAAZ;AACA,kBAAKE,MAAL;AACD,WA1BmD;;AAAA,gBA4BpDC,cA5BoD,GA4BnC,YAAM;AACrB,kBAAKC,YAAL,CAAkB,SAAlB,EAA6B7C,uBAA7B,EAAsD,CAAtD;AACA,kBAAK6C,YAAL,CAAkB,MAAlB,EAA0B5C,oBAA1B,EAAgD,CAAhD;AACA,kBAAK6C,WAAL,GAAmB1D,IAAI2D,cAAJ,EAAnB;AACD,WAhCmD;;AAAA,gBAkCpDC,QAlCoD,GAkCzC,YAAM;AACf,gBAAI,CAAC,MAAKP,QAAV,EAAoB;AAAE;AAAS;AAC/B,kBAAKb,IAAL,GAAY,MAAKc,aAAL,CAAmB,MAAKD,QAAxB,CAAZ;AACD,WArCmD;;AAAA,gBAoFpDQ,iBApFoD,GAoFhC,UAACC,QAAD,EAAc;AAChC,kBAAKC,KAAL,CAAW3C,KAAX,CAAiBI,SAAjB,GAA6BsC,QAA7B;AACA,kBAAKP,MAAL;AACD,WAvFmD;;AAAA,gBAyFpDS,mBAzFoD,GAyF9B,UAACC,WAAD;AAAA,mBAAiB,UAACH,QAAD,EAAc;AACnDG,0BAAY7C,KAAZ,GAAoB0C,QAApB;AACA,oBAAKP,MAAL;AACD,aAHqB;AAAA,WAzF8B;;AAGlD,gBAAKF,QAAL,GAAgB,IAAhB;AACA,gBAAKb,IAAL,GAAY,EAAZ;AACA,gBAAKW,OAAL,GAAeA,OAAf;AACA,gBAAKR,YAAL,GAAoBA,YAApB;AACA,gBAAKuB,eAAL,GAAuB7D,YAAvB;AACA,gBAAK8D,gBAAL,GAAwBhE,aAAxB;AACA,gBAAKiE,gBAAL,GAAwB7D,aAAxB;AACA,gBAAK8D,iBAAL,GAAyB5D,cAAzB;AACA,gBAAK6D,iBAAL,GAAyB5D,YAAzB;AACA,gBAAK6D,KAAL,GAAazD,cAAc0D,QAAd,EAAb;;AAEAzE,YAAE0E,YAAF,CAAe,MAAKV,KAApB,EAA2BhD,aAA3B;;AAEA,gBAAK2D,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKvB,cAArC;AACA,gBAAKsB,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKvB,cAA1C;AACA,gBAAKsB,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKnB,cAAtC;AACA,gBAAKkB,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,MAAKf,QAA9B;AAnBkD;AAoBnD;;;;wCAmBapB,I,EAAM;AAClB,gBAAMoC,YAAY3E,gBAAgB,KAAK8D,KAAL,CAAW/C,SAA3B,EAAsC,KAAK+C,KAAL,CAAW7C,QAAjD,CAAlB;;AADkB,uBAEG,KAAK2D,KAAL,IAAc,KAAK1B,OAAL,CAAa2B,SAAb,EAFjB;AAAA,gBAEVC,IAFU,QAEVA,IAFU;AAAA,gBAEJC,EAFI,QAEJA,EAFI;;AAGlB,mBAAOJ,UAAUK,WAAV,CAAsBF,IAAtB,EAA4BC,EAA5B,EAAgCxC,IAAhC,CAAP;AACD;;;+BAEI0C,K,EAAOC,I,EAAMC,K,EAAOC,I,EAAM;AAC7B1E,4BAAgBuE,KAAhB,EAAuBC,IAAvB,EAA6BC,KAA7B,EAAoCC,IAApC;AACD;;;2CAEgB;AACf,iBAAKtB,KAAL,CAAW3C,KAAX,CAAiBK,YAAjB,CAA8B6D,IAA9B,CAAmC,EAAElE,OAAO,SAAT,EAAnC;AACA,iBAAKmC,MAAL;AACD;;;4CAEiBgC,C,EAAG;AACnB,gBAAI,KAAKxB,KAAL,CAAW3C,KAAX,CAAiBK,YAAjB,CAA8B+D,MAA9B,GAAuC,CAA3C,EAA8C;AAC5C,mBAAKzB,KAAL,CAAW3C,KAAX,CAAiBK,YAAjB,CAA8BgE,MAA9B,CAAqCF,CAArC,EAAwC,CAAxC;AACA,mBAAKhC,MAAL;AACD;AACF;;;4CAEiBgC,C,EAAG;AACnB,gBAAMG,IAAIH,MAAM,CAAN,GACN,KAAKxB,KAAL,CAAW3C,KAAX,CAAiBK,YAAjB,CAA8B+D,MAA9B,GAAuC,CADjC,GAEND,IAAI,CAFR;AAGA,iBAAKI,gBAAL,CAAsBJ,CAAtB,EAAyBG,CAAzB;AACA,iBAAKnC,MAAL;AACD;;;8CAEmBgC,C,EAAG;AACrB,gBAAMG,IAAIH,MAAM,KAAKxB,KAAL,CAAW3C,KAAX,CAAiBK,YAAjB,CAA8B+D,MAA9B,GAAuC,CAA7C,GACN,CADM,GAEND,IAAI,CAFR;AAGA,iBAAKI,gBAAL,CAAsBJ,CAAtB,EAAyBG,CAAzB;AACA,iBAAKnC,MAAL;AACD;;;2CAEgBgC,C,EAAGG,C,EAAG;AACrB,gBAAME,SAAS,KAAK7B,KAAL,CAAW3C,KAAX,CAAiBK,YAAhC;AACA,gBAAMoE,OAAOD,OAAOF,CAAP,CAAb;AACAE,mBAAOF,CAAP,IAAYE,OAAOL,CAAP,CAAZ;AACAK,mBAAOL,CAAP,IAAYM,IAAZ;AACD;;;;QArFiC/F,gB;;;;AAAvBiD,oB,CACJ+C,W,GAAc,a","file":"carpetplot-ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\n\nimport createConverter from './data-converter';\nimport aggregates, { aggregatesMap } from './aggregates';\nimport fragments, { fragmentsMap } from './fragments';\nimport colorModes, { colorModesMap } from './color-modes';\nimport colorSpaces, { colorSpacesMap } from './color-spaces';\nimport { labelFormats } from './x-axis-label-formats';\nimport canvasRendering from './canvas/rendering';\nimport { carpetplotDisplayEditor } from './display-editor';\nimport { carpetplotAxesEditor } from './axes-editor';\nimport themeProvider from './theme-provider';\nimport './css/carpet-plot.css!';\n\nconst panelDefaults = {\n  aggregate: aggregates.AVG,\n  fragment: fragments.HOUR,\n  color: {\n    mode: colorModes.SPECTRUM,\n    colorScheme: 'interpolateRdYlGn',\n    nullColor: 'transparent',\n    customColors: [{\n      color: '#006837'\n    }, {\n      color: '#aa0526'\n    }],\n    colorSpace: colorSpaces.RGB\n  },\n  scale: {\n    min: null,\n    max: null\n  },\n  xAxis: {\n    show: true,\n    showWeekends: true,\n    minBucketWidthToShowWeekends: 4,\n    showCrosshair: true,\n    labelFormat: '%a %m/%d'\n  },\n  yAxis: {\n    show: true,\n    showCrosshair: false\n  },\n  tooltip: {\n    show: true\n  },\n  legend: {\n    show: true\n  },\n  data: {\n    unitFormat: 'short',\n    decimals: null\n  }\n};\n\nconst colorSchemes = [\n  // Diverging\n  { name: 'Spectral', value: 'interpolateSpectral', invert: 'always' },\n  { name: 'RdYlGn', value: 'interpolateRdYlGn', invert: 'always' },\n\n  // Sequential (Single Hue)\n  { name: 'Blues', value: 'interpolateBlues', invert: 'dark' },\n  { name: 'Greens', value: 'interpolateGreens', invert: 'dark' },\n  { name: 'Greys', value: 'interpolateGreys', invert: 'dark' },\n  { name: 'Oranges', value: 'interpolateOranges', invert: 'dark' },\n  { name: 'Purples', value: 'interpolatePurples', invert: 'dark' },\n  { name: 'Reds', value: 'interpolateReds', invert: 'dark' },\n\n  // Sequential (Multi-Hue)\n  { name: 'BuGn', value: 'interpolateBuGn', invert: 'dark' },\n  { name: 'BuPu', value: 'interpolateBuPu', invert: 'dark' },\n  { name: 'GnBu', value: 'interpolateGnBu', invert: 'dark' },\n  { name: 'OrRd', value: 'interpolateOrRd', invert: 'dark' },\n  { name: 'PuBuGn', value: 'interpolatePuBuGn', invert: 'dark' },\n  { name: 'PuBu', value: 'interpolatePuBu', invert: 'dark' },\n  { name: 'PuRd', value: 'interpolatePuRd', invert: 'dark' },\n  { name: 'RdPu', value: 'interpolateRdPu', invert: 'dark' },\n  { name: 'YlGnBu', value: 'interpolateYlGnBu', invert: 'dark' },\n  { name: 'YlGn', value: 'interpolateYlGn', invert: 'dark' },\n  { name: 'YlOrBr', value: 'interpolateYlOrBr', invert: 'dark' },\n  { name: 'YlOrRd', value: 'interpolateYlOrRd', invert: 'darm' }\n];\n\nexport class CarpetPlotCtrl extends MetricsPanelCtrl {\n  static templateUrl = 'module.html';\n\n  constructor($scope, $injector, $rootScope, timeSrv) {\n    super($scope, $injector);\n\n    this.dataList = null;\n    this.data = {};\n    this.timeSrv = timeSrv;\n    this.colorSchemes = colorSchemes;\n    this.fragmentOptions = fragmentsMap;\n    this.aggregateOptions = aggregatesMap;\n    this.colorModeOptions = colorModesMap;\n    this.colorSpaceOptions = colorSpacesMap;\n    this.xAxisLabelFormats = labelFormats;\n    this.theme = themeProvider.getTheme();\n\n    _.defaultsDeep(this.panel, panelDefaults);\n\n    this.events.on('data-received', this.onDataReceived);\n    this.events.on('data-snapshot-load', this.onDataReceived);\n    this.events.on('init-edit-mode', this.onInitEditMode);\n    this.events.on('render', this.onRender);\n  }\n\n  onDataReceived = (dataList) => {\n    this.dataList = dataList;\n    this.data = this.transformData(dataList);\n    this.render();\n  }\n\n  onInitEditMode = () => {\n    this.addEditorTab('Display', carpetplotDisplayEditor, 2);\n    this.addEditorTab('Axes', carpetplotAxesEditor, 3);\n    this.unitFormats = kbn.getUnitFormats();\n  }\n\n  onRender = () => {\n    if (!this.dataList) { return; }\n    this.data = this.transformData(this.dataList);\n  }\n\n  transformData(data) {\n    const converter = createConverter(this.panel.aggregate, this.panel.fragment);\n    const { from, to } = this.range || this.timeSrv.timeRange();\n    return converter.convertData(from, to, data);\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    canvasRendering(scope, elem, attrs, ctrl);\n  }\n\n  addCustomColor() {\n    this.panel.color.customColors.push({ color: '#ffffff' });\n    this.render();\n  }\n\n  removeCustomColor(i) {\n    if (this.panel.color.customColors.length > 2) {\n      this.panel.color.customColors.splice(i, 1);\n      this.render();\n    }\n  }\n\n  moveCustomColorUp(i) {\n    const j = i === 0\n      ? this.panel.color.customColors.length - 1\n      : i - 1;\n    this.swapCustomColors(i, j);\n    this.render();\n  }\n\n  moveCustomColorDown(i) {\n    const j = i === this.panel.color.customColors.length - 1\n      ? 0\n      : i + 1;\n    this.swapCustomColors(i, j);\n    this.render();\n  }\n\n  swapCustomColors(i, j) {\n    const colors = this.panel.color.customColors;\n    const temp = colors[j];\n    colors[j] = colors[i];\n    colors[i] = temp;\n  }\n\n  onNullColorChange = (newColor) => {\n    this.panel.color.nullColor = newColor;\n    this.render();\n  }\n\n  onCustomColorChange = (customColor) => (newColor) => {\n    customColor.color = newColor;\n    this.render();\n  }\n}"]}